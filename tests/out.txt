============================= test session starts ==============================
platform darwin -- Python 3.5.6, pytest-5.3.0, py-1.8.0, pluggy-0.13.0 -- /Users/ernesto/miniconda3/envs/python3_5_env/bin/python
cachedir: .pytest_cache
rootdir: /Users/ernesto/PycharmProjects/FOREX/tests
collecting ... collected 7 items

test_Counter.py::test_set_pivots[EUR_JPY-D-EUR_JPY 27OCT2009D-2009-10-26 22:00:00-short-137.305-138.66-134.1-136.852-dates0] Date precedes the start of the historical record.
Time was rolled from 1998-11-13 22:00:00 to 2002-06-05 21:00:00
Date precedes the start of the historical record.
Time was rolled from 1996-12-13 21:00:00 to 2002-06-05 21:00:00
[DEBUG] Running __inarea_pivots
[DEBUG] Pivot 2003-07-27 21:00:00 identified in area
[DEBUG] Running merge_pre
[DEBUG] Analysis of pivot 2003-07-27 21:00:00
[DEBUG] self.pre start pre-merge: 2003-07-14 21:00:00
[DEBUG] self.pre start after-merge: 2003-07-14 21:00:00
[DEBUG] Done merge_pre
[DEBUG] Running merge_aft
[DEBUG] Analysis of pivot 2003-07-27 21:00:00
[DEBUG] self.aft end before the merge: 2003-09-01 21:00:00
[DEBUG] Skipping merge because of %_diff
[DEBUG] self.aft end after-merge: 2003-09-01 21:00:00
[DEBUG] Done merge_aft
[DEBUG] Pivot 2004-01-10 22:00:00 identified in area
[DEBUG] Running merge_pre
[DEBUG] Analysis of pivot 2004-01-10 22:00:00
[DEBUG] self.pre start pre-merge: 2003-11-09 22:00:00
[DEBUG] self.pre start after-merge: 2003-11-09 22:00:00
[DEBUG] Done merge_pre
[DEBUG] Running merge_aft
[DEBUG] Analysis of pivot 2004-01-10 22:00:00
[DEBUG] self.aft end before the merge: 2004-01-31 22:00:00
[DEBUG] self.aft end after-merge: 2004-01-31 22:00:00
[DEBUG] Done merge_aft
[DEBUG] Pivot 2004-05-16 21:00:00 identified in area
[DEBUG] Running merge_pre
[DEBUG] Analysis of pivot 2004-05-16 21:00:00
[DEBUG] self.pre start pre-merge: 2004-04-04 21:00:00
[DEBUG] Merge because of same Segment type
[DEBUG] self.pre start after-merge: 2004-02-01 22:00:00
[DEBUG] Done merge_pre
[DEBUG] Running merge_aft
[DEBUG] Analysis of pivot 2004-05-16 21:00:00
[DEBUG] self.aft end before the merge: 2004-06-22 21:00:00
[DEBUG] self.aft end after-merge: 2004-06-22 21:00:00
[DEBUG] Done merge_aft
[DEBUG] Pivot 2004-08-12 21:00:00 identified in area
[DEBUG] Running merge_pre
[DEBUG] Analysis of pivot 2004-08-12 21:00:00
[DEBUG] self.pre start pre-merge: 2004-06-23 21:00:00
[DEBUG] self.pre start after-merge: 2004-06-23 21:00:00
[DEBUG] Done merge_pre
[DEBUG] Running merge_aft
[DEBUG] Analysis of pivot 2004-08-12 21:00:00
[DEBUG] self.aft end before the merge: 2004-08-26 21:00:00
[DEBUG] self.aft end after-merge: 2004-08-26 21:00:00
[DEBUG] Done merge_aft
[DEBUG] Pivot 2006-01-11 22:00:00 identified in area
[DEBUG] Running merge_pre
[DEBUG] Analysis of pivot 2006-01-11 22:00:00
[DEBUG] self.pre start pre-merge: 2005-12-12 22:00:00
[DEBUG] self.pre start after-merge: 2005-12-12 22:00:00
[DEBUG] Done merge_pre
[DEBUG] Running merge_aft
[DEBUG] Analysis of pivot 2006-01-11 22:00:00
[DEBUG] self.aft end before the merge: 2006-01-31 22:00:00
[DEBUG] self.aft end after-merge: 2006-01-31 22:00:00
[DEBUG] Done merge_aft
[DEBUG] Pivot 2006-02-26 22:00:00 identified in area
[DEBUG] Running merge_pre
[DEBUG] Analysis of pivot 2006-02-26 22:00:00
[DEBUG] self.pre start pre-merge: 2006-02-01 22:00:00
[DEBUG] self.pre start after-merge: 2006-02-01 22:00:00
[DEBUG] Done merge_pre
[DEBUG] Running merge_aft
[DEBUG] Analysis of pivot 2006-02-26 22:00:00
[DEBUG] self.aft end before the merge: 2007-02-20 22:00:00
[DEBUG] Merge because of s.count < n_candles
[DEBUG] Merge because of same Segment type
[DEBUG] self.aft end after-merge: 2007-07-10 21:00:00
[DEBUG] Done merge_aft
[DEBUG] Pivot 2009-04-05 21:00:00 identified in area
[DEBUG] Running merge_pre
[DEBUG] Analysis of pivot 2009-04-05 21:00:00
[DEBUG] self.pre start pre-merge: 2009-03-29 21:00:00
[DEBUG] Skipping merge because of %_diff
[DEBUG] self.pre start after-merge: 2009-03-29 21:00:00
[DEBUG] Done merge_pre
[DEBUG] Running merge_aft
[DEBUG] Analysis of pivot 2009-04-05 21:00:00
[DEBUG] self.aft end before the merge: 2009-04-25 21:00:00
[DEBUG] Skipping merge because of %_diff
[DEBUG] self.aft end after-merge: 2009-04-25 21:00:00
[DEBUG] Done merge_aft
[DEBUG] Running merge_pre
[DEBUG] Analysis of pivot 2009-10-22 21:00:00
[DEBUG] self.pre start pre-merge: 2009-10-06 21:00:00
[DEBUG] self.pre start after-merge: 2009-10-06 21:00:00
[DEBUG] Done merge_pre
[DEBUG] Done __inarea_pivots
PASSED
test_Counter.py::test_set_pivots[EUR_JPY-D-EUR_JPY 15JUL2009D-2009-07-14 22:00:00-long-127.766-126.421-137.232-130.865-dates1] Date precedes the start of the historical record.
Time was rolled from 1998-08-01 22:00:00 to 2002-06-05 21:00:00
Date precedes the start of the historical record.
Time was rolled from 1996-12-13 21:00:00 to 2002-06-05 21:00:00
[DEBUG] Running __inarea_pivots
[DEBUG] Pivot 2009-01-03 22:00:00 identified in area
[DEBUG] Running merge_pre
[DEBUG] Analysis of pivot 2009-01-03 22:00:00
[DEBUG] self.pre start pre-merge: 2008-11-30 22:00:00
[DEBUG] Merge because of s.count < n_candles
[DEBUG] Merge because of same Segment type
[DEBUG] Skipping merge because of %_diff
[DEBUG] self.pre start after-merge: 2008-11-19 22:00:00
[DEBUG] Done merge_pre
[DEBUG] Running merge_aft
[DEBUG] Analysis of pivot 2009-01-03 22:00:00
[DEBUG] self.aft end before the merge: 2009-01-12 22:00:00
[DEBUG] Merge because of s.count < n_candles
[DEBUG] Merge because of same Segment type
[DEBUG] Merge because of s.count < n_candles
[DEBUG] Merge because of same Segment type
[DEBUG] self.aft end after-merge: 2009-01-31 22:00:00
[DEBUG] Done merge_aft
[DEBUG] Pivot 2009-05-16 21:00:00 identified in area
[DEBUG] Running merge_pre
[DEBUG] Analysis of pivot 2009-05-16 21:00:00
[DEBUG] self.pre start pre-merge: 2009-05-09 21:00:00
[DEBUG] Skipping merge because of %_diff
[DEBUG] self.pre start after-merge: 2009-05-09 21:00:00
[DEBUG] Done merge_pre
[DEBUG] Running merge_aft
[DEBUG] Analysis of pivot 2009-05-16 21:00:00
[DEBUG] self.aft end before the merge: 2009-06-10 21:00:00
[DEBUG] self.aft end after-merge: 2009-06-10 21:00:00
[DEBUG] Done merge_aft
[DEBUG] Running merge_pre
[DEBUG] Analysis of pivot 2009-07-11 21:00:00
[DEBUG] self.pre start pre-merge: 2009-06-11 21:00:00
[DEBUG] self.pre start after-merge: 2009-06-11 21:00:00
[DEBUG] Done merge_pre
[DEBUG] Done __inarea_pivots
PASSED
test_Counter.py::test_set_pivots[NZD_USD-H12-NZD_USD 01JUL2019H12-2019-07-01 09:00:00-short-0.67095-0.67258-0.66328-0.66887-dates2] [DEBUG] Running __inarea_pivots
[DEBUG] Pivot 2016-05-29 21:00:00 identified in area
[DEBUG] Running merge_pre
[DEBUG] Analysis of pivot 2016-05-29 21:00:00
[DEBUG] self.pre start pre-merge: 2016-04-18 21:00:00
[DEBUG] self.pre start after-merge: 2016-04-18 21:00:00
[DEBUG] Done merge_pre
[DEBUG] Running merge_aft
[DEBUG] Analysis of pivot 2016-05-29 21:00:00
[DEBUG] self.aft end before the merge: 2016-06-21 21:00:00
[DEBUG] Merge because of s.count < n_candles
[DEBUG] Merge because of same Segment type
[DEBUG] Skipping merge because of %_diff
[DEBUG] self.aft end after-merge: 2016-07-06 21:00:00
[DEBUG] Done merge_aft
[DEBUG] Pivot 2019-01-01 22:00:00 identified in area
[DEBUG] Running merge_pre
[DEBUG] Analysis of pivot 2019-01-01 22:00:00
[DEBUG] self.pre start pre-merge: 2018-12-03 22:00:00
[DEBUG] self.pre start after-merge: 2018-12-03 22:00:00
[DEBUG] Done merge_pre
[DEBUG] Running merge_aft
[DEBUG] Analysis of pivot 2019-01-01 22:00:00
[DEBUG] self.aft end before the merge: 2019-01-29 22:00:00
[DEBUG] self.aft end after-merge: 2019-01-29 22:00:00
[DEBUG] Done merge_aft
[DEBUG] Running merge_pre
[DEBUG] Analysis of pivot 2019-06-27 21:00:00
[DEBUG] self.pre start pre-merge: 2019-06-13 21:00:00
[DEBUG] self.pre start after-merge: 2019-06-13 21:00:00
[DEBUG] Done merge_pre
[DEBUG] Done __inarea_pivots
PASSED
test_Counter.py::test_set_pivots[EUR_AUD-D-EUR_AUD 04DEC2018D-2018-12-03 22:00:00-long-1.54123-1.53398-1.55752-1.54334-dates3] Time was rolled from 2007-12-21 22:00:00 to 2007-12-22 22:00:00
Date precedes the start of the historical record.
Time was rolled from 2002-07-01 22:00:00 to 2004-06-05 21:00:00
[DEBUG] Running __inarea_pivots
[DEBUG] Running merge_pre
[DEBUG] Analysis of pivot 2018-11-29 22:00:00
[DEBUG] self.pre start pre-merge: 2018-10-04 21:00:00
[DEBUG] self.pre start after-merge: 2018-10-04 21:00:00
[DEBUG] Done merge_pre
[DEBUG] Done __inarea_pivots
PASSED
test_Counter.py::test_set_pivots[EUR_AUD-D-EUR_AUD 08MAY2017D-2017-05-08 22:00:00-short-1.4882-1.49191-1.46223-1.48004-dates4] Date precedes the start of the historical record.
Time was rolled from 2000-12-04 21:00:00 to 2004-06-05 21:00:00
[DEBUG] Running __inarea_pivots
[DEBUG] Pivot 2010-07-17 21:00:00 identified in area
[DEBUG] Running merge_pre
[DEBUG] Analysis of pivot 2010-07-17 21:00:00
[DEBUG] self.pre start pre-merge: 2010-07-11 21:00:00
[DEBUG] Skipping merge because of %_diff
[DEBUG] self.pre start after-merge: 2010-07-11 21:00:00
[DEBUG] Done merge_pre
[DEBUG] Running merge_aft
[DEBUG] Analysis of pivot 2010-07-17 21:00:00
[DEBUG] self.aft end before the merge: 2010-09-10 21:00:00
[DEBUG] self.aft end after-merge: 2010-09-10 21:00:00
[DEBUG] Done merge_aft
[DEBUG] Pivot 2013-08-01 21:00:00 identified in area
[DEBUG] Running merge_pre
[DEBUG] Analysis of pivot 2013-08-01 21:00:00
[DEBUG] self.pre start pre-merge: 2013-07-08 21:00:00
[DEBUG] Merge because of s.count < n_candles
[DEBUG] Merge because of same Segment type
[DEBUG] self.pre start after-merge: 2013-03-26 21:00:00
[DEBUG] Done merge_pre
[DEBUG] Running merge_aft
[DEBUG] Analysis of pivot 2013-08-01 21:00:00
[DEBUG] self.aft end before the merge: 2013-10-16 21:00:00
[DEBUG] self.aft end after-merge: 2013-10-16 21:00:00
[DEBUG] Done merge_aft
[DEBUG] Running merge_pre
[DEBUG] Analysis of pivot 2017-05-07 21:00:00
[DEBUG] self.pre start pre-merge: 2017-02-21 22:00:00
[DEBUG] self.pre start after-merge: 2017-02-21 22:00:00
[DEBUG] Done merge_pre
[DEBUG] Done __inarea_pivots
PASSED
test_Counter.py::test_set_pivots[EUR_AUD-D-EUR_AUD 24MAY2019D-2019-05-23 22:00:00-short-1.62344-1.62682-1.60294-1.61739-dates5] Time was rolled from 2019-05-24 22:00:00 to 2019-05-25 22:00:00
Date precedes the start of the historical record.
Time was rolled from 2002-12-18 21:00:00 to 2004-06-05 21:00:00
FAILED
>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> traceback >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

pair = 'EUR_AUD', id = 'EUR_AUD 24MAY2019D', timeframe = 'D'
start = '2019-05-23 22:00:00', type = 'short', SR = 1.62344, SL = 1.62682
TP = 1.60294, entry = 1.61739
dates = [datetime.datetime(2008, 7, 15, 21, 0), datetime.datetime(2015, 8, 23, 21, 0), datetime.datetime(2018, 12, 30, 22, 0), datetime.datetime(2019, 5, 21, 21, 0)]

    @pytest.mark.parametrize("pair,"
                             "timeframe,"
                             "id,"
                             "start,"
                             "type,"
                             "SR,"
                             "SL,"
                             "TP,"
                             "entry,"
                             "dates",
                             [ ('EUR_JPY', 'D', 'EUR_JPY 27OCT2009D', '2009-10-26 22:00:00', 'short', 137.305, 138.66, 134.1, 136.852,
                               [datetime.datetime(2003, 7, 27, 21, 0), datetime.datetime(2004, 1, 10, 22, 0),
                                datetime.datetime(2004, 5, 16, 21, 0), datetime.datetime(2004, 8, 12, 21, 0),
                                datetime.datetime(2006, 1, 11, 22, 0), datetime.datetime(2006, 2, 26, 22, 0),
                                datetime.datetime(2009, 4, 5, 21, 0), datetime.datetime(2009, 10, 22, 21, 0)]),
                               ('EUR_JPY', 'D', 'EUR_JPY 15JUL2009D', '2009-07-14 22:00:00', 'long', 127.766, 126.421, 137.232, 130.865,
                               [datetime.datetime(2009, 1, 3, 22, 0), datetime.datetime(2009, 5, 16, 21, 0),
                                datetime.datetime(2009, 7, 11, 21, 0)]),
                              ('NZD_USD', 'H12', 'NZD_USD 01JUL2019H12', '2019-07-01 09:00:00', 'short', 0.67095, 0.67258, 0.66328, 0.66887,
                               [datetime.datetime(2016, 5, 29, 21, 0), datetime.datetime(2019, 1, 1, 22, 0),
                                datetime.datetime(2019, 6, 27, 21, 0)]),
                              ('EUR_AUD', 'D', 'EUR_AUD 04DEC2018D', '2018-12-03 22:00:00', 'long', 1.54123, 1.53398, 1.55752, 1.54334,
                               [datetime.datetime(2018, 11, 29, 22, 0)]),
                              ('EUR_AUD', 'D', 'EUR_AUD 08MAY2017D', '2017-05-08 22:00:00', 'short', 1.48820, 1.49191, 1.46223, 1.48004,
                               [datetime.datetime(2010, 7, 17, 21, 0), datetime.datetime(2013, 8, 1, 21, 0),
                                datetime.datetime(2017, 5, 7, 21, 0)]),
                               ('EUR_AUD', 'D', 'EUR_AUD 24MAY2019D', '2019-05-23 22:00:00', 'short', 1.62344, 1.62682, 1.60294, 1.61739,
                                [datetime.datetime(2008, 7, 15, 21, 0), datetime.datetime(2015, 8, 23, 21, 0),
                                datetime.datetime(2018, 12, 30, 22, 0), datetime.datetime(2019, 5, 21, 21, 0)]),
                               ('GBP_USD', 'D', 'GBP_USD 18APR2018D', '2018-04-17 22:00:00', 'short', 1.43690, 1.43778, 1.41005, 1.42681,
                               [datetime.datetime(2008, 12, 28, 22, 0), datetime.datetime(2009, 4, 21, 21, 0),
                                datetime.datetime(2010, 5, 17, 21, 0), datetime.datetime(2018, 4, 15, 21, 0)])])
    def test_set_pivots(pair, id, timeframe, start, type, SR, SL, TP, entry, dates):
        """
        Check that self.pivots class attribute
        """
    
        t = Trade(
            id=id,
            start=start,
            pair=pair,
            timeframe='D',
            type=type,
            SR=SR,
            SL=SL,
            TP=TP,
            entry=entry,
            strat='counter_b1',
            settingf="data/settings.ini"
        )
    
        c = Counter(
            trade=t,
>           settingf='data/settings.ini'
        )

test_Counter.py:156: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../src/Pattern/counter.py:78: in __init__
    self.clist_period.calc_rsi()
../src/candlelist.py:392: in calc_rsi
    end=end_time.isoformat())
../src/oanda_api.py:67: in wrapper
    return function(*args, **kwargs)
../src/oanda_api.py:122: in run
    params=params)
../../../miniconda3/envs/python3_5_env/lib/python3.5/site-packages/requests/api.py:75: in get
    return request('get', url, params=params, **kwargs)
../../../miniconda3/envs/python3_5_env/lib/python3.5/site-packages/requests/api.py:60: in request
    return session.request(method=method, url=url, **kwargs)
../../../miniconda3/envs/python3_5_env/lib/python3.5/site-packages/requests/sessions.py:533: in request
    resp = self.send(prep, **send_kwargs)
../../../miniconda3/envs/python3_5_env/lib/python3.5/site-packages/requests/sessions.py:686: in send
    r.content
../../../miniconda3/envs/python3_5_env/lib/python3.5/site-packages/requests/models.py:828: in content
    self._content = b''.join(self.iter_content(CONTENT_CHUNK_SIZE)) or b''
../../../miniconda3/envs/python3_5_env/lib/python3.5/site-packages/requests/models.py:750: in generate
    for chunk in self.raw.stream(chunk_size, decode_content=True):
../../../miniconda3/envs/python3_5_env/lib/python3.5/site-packages/urllib3/response.py:564: in stream
    data = self.read(amt=amt, decode_content=decode_content)
../../../miniconda3/envs/python3_5_env/lib/python3.5/site-packages/urllib3/response.py:507: in read
    data = self._fp.read(amt) if not fp_closed else b""
../../../miniconda3/envs/python3_5_env/lib/python3.5/http/client.py:448: in read
    n = self.readinto(b)
../../../miniconda3/envs/python3_5_env/lib/python3.5/http/client.py:488: in readinto
    n = self.fp.readinto(b)
../../../miniconda3/envs/python3_5_env/lib/python3.5/socket.py:576: in readinto
    return self._sock.recv_into(b)
../../../miniconda3/envs/python3_5_env/lib/python3.5/ssl.py:937: in recv_into
    return self.read(nbytes, buffer)
../../../miniconda3/envs/python3_5_env/lib/python3.5/ssl.py:799: in read
    return self._sslobj.read(len, buffer)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <ssl.SSLObject object at 0x12541c358>, len = 9556
buffer = <memory at 0x11f4aedc8>

    def read(self, len=1024, buffer=None):
        """Read up to 'len' bytes from the SSL object and return them.
    
        If 'buffer' is provided, read into this buffer and return the number of
        bytes read.
        """
        if buffer is not None:
>           v = self._sslobj.read(len, buffer)
E           KeyboardInterrupt

../../../miniconda3/envs/python3_5_env/lib/python3.5/ssl.py:583: KeyboardInterrupt
>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> entering PDB >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> PDB post_mortem >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
> /Users/ernesto/miniconda3/envs/python3_5_env/lib/python3.5/ssl.py(583)read()
-> v = self._sslobj.read(len, buffer)
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) (Pdb) (Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) (Pdb) (Pdb) (Pdb) *** NameError: name 'รง' is not defined
(Pdb) *** NameError: name 'รง' is not defined
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) --KeyboardInterrupt--
(Pdb) 